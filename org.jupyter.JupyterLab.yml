app-id: org.jupyter.JupyterLab
runtime: org.freedesktop.Platform
runtime-version: '21.08'
sdk: org.freedesktop.Sdk

command: jl.sh

finish-args:
  # allow displaying on x11 and wayland
  - --share=ipc
  - --socket=x11
  - --socket=wayland
  # for electron gpu acceleration
  - --device=dri
  # allow network access
  - --share=network

cleanup:
  - /lib/debug

modules:
  - name: jupyterlab
    buildsystem: simple
    build-commands:
        # extract deb file and run post install script
      - ar x JupyterLab-Setup-Debian.deb
      - tar -xf data.tar.xz -C $FLATPAK_DEST
      - $FLATPAK_DEST/opt/JupyterLab/resources/env_installer/JupyterLabAppServer-3.1.12-1-Linux-x86_64.sh -b -p "$FLATPAK_DEST/opt/JupyterLab/resources/jlab_server"
        # wrapper to launch app
      - install -Dm755 -t $FLATPAK_DEST/bin/ jl.sh
        # install icons and desktop file
      - install -Dm644 org.jupyter.JupyterLab.desktop $FLATPAK_DEST/share/applications/org.jupyter.JupyterLab.desktop
      - mkdir -p $FLATPAK_DEST/share/icons
      - cp -r hicolor $FLATPAK_DEST/share/icons
    sources:
      - type: file
        url: https://github.com/jupyterlab/jupyterlab_app/releases/download/v3.1.12-1/JupyterLab-Setup-Debian.deb
        sha256: 75997ce3bc455955833875147bd8f003f99b0eab525ab93933f4cb13a6116d15
      - type: file
        path: jl.sh
      - type: file
        path: org.jupyter.JupyterLab.desktop
      - type: archive
        path: icons.zip
